!function(a){"use strict";a.fn.bootstrapTreeTable=function(b,c){var e,f,g,h,d=null;return"string"==typeof b?a.fn.bootstrapTreeTable.methods[b](this,c):(b=a.extend({},a.fn.bootstrapTreeTable.defaults,b||{}),e=!1,f=a(this),g=a("<div class='bootstrap-tree-table'></div>"),f.before(g),g.append(f),f.addClass("table table-hover treetable-table"),b.striped&&f.addClass("table-striped"),b.bordered&&f.addClass("table-bordered"),b.toolbar&&(h=a("<div class='treetable-bars pull-left'></div>"),h.append(a(b.toolbar)),g.before(h)),f.formatData=function(c){var e=b.rootCodeValue?b.rootCodeValue:null;a.each(c,function(a,c){c.isShow=!1;var f="0"==c[b.parentCode]||0==c[b.parentCode]||null==c[b.parentCode]||""==c[b.parentCode];!c[b.parentCode]||(e?c[b.parentCode]==b.rootCodeValue:f)?(d["_root_"]||(d["_root_"]=[]),d["_root_"].push(c)):(d["_n_"+c[b.parentCode]]||(d["_n_"+c[b.parentCode]]=[]),d["_n_"+c[b.parentCode]].push(c))}),c=null},f.getRootNodes=function(){return d["_root_"]},f.handleNode=function(c,e,g,h,i){var j=d["_n_"+c[b.code]],k=f.renderRow(c,j?!0:!1,e,g,h);i.append(k),j&&a.each(j,function(a,b){var c=g+"_"+a;f.handleNode(b,e+1,c,g,i)})},f.renderRow=function(c,d,f,g,h){var i,j;return c.isShow=!0,i=a('<tr id="'+g+'" pid="'+h+'"></tr>'),j=b.expanderCollapsedClass,b.expandAll?(i.css("display","table"),j=b.expanderExpandedClass):1==f?(i.css("display","table"),j=b.expandFirst?b.expanderExpandedClass:b.expanderCollapsedClass):2==f?(b.expandFirst?i.css("display","table"):i.css("display","none"),j=b.expanderCollapsedClass):(i.css("display","none"),j=b.expanderCollapsedClass),a.each(b.columns,function(g,h){var k,l,m;if("selectItem"==h.field)e=!0,k=a('<td style="text-align:center;width:36px"></td>'),h.radio&&(l=a('<input name="select_item" type="radio" value="'+c[b.id]+'"></input>'),k.append(l)),h.checkbox&&(l=a('<input name="select_item" type="checkbox" value="'+c[b.id]+'"></input>'),k.append(l)),i.append(k);else{if(k=a('<td title="'+c[h.field]+'" name="'+h.field+'" style="'+(h.width?"width:"+h.width:"")+'"></td>'),h.formatter?k.html(h.formatter.call(this,c[h.field],c,g)):k.text(c[h.field]),b.expandColumn==g)for(d?k.prepend('<span class="treetable-expander '+j+'"></span>'):k.prepend('<span class="treetable-expander"></span>'),m=0;f-1>m;m++)k.prepend('<span class="treetable-indent"></span>');i.append(k)}}),i},f.load=function(c){var g,h,i,j;d={},f.html(""),g=a("<tr></tr>"),a.each(b.columns,function(b,c){var d=null;0==b&&"selectItem"==c.field?(e=!0,d=a('<th style="width:36px"></th>')):d=a('<th style="'+(c.width?"width:"+c.width:"")+'"></th>'),d.text(c.title),g.append(d)}),h=a('<thead class="treetable-thead"></thead>'),h.append(g),f.append(h),i=a('<tbody class="treetable-tbody"></tbody>'),f.append(i),j='<tr><td colspan="'+b.columns.length+'"><div style="display: block;text-align: center;">正在努力地加载数据中，请稍候……</div></td></tr>',i.html(j),b.height&&i.css("height",b.height),b.url?a.ajax({type:b.type,url:b.url,data:c?c:b.ajaxParams,dataType:"JSON",success:function(a){f.renderTable(a)},error:function(a){var d='<tr><td colspan="'+b.columns.length+'"><div style="display: block;text-align: center;">'+a.responseText+"</div></td></tr>";i.html(d)}}):f.renderTable(b.data)},f.renderTable=function(c){var h,i,d=f.find("tbody"),g=f.find("thead");return d.html(""),!c||c.length<=0?(h='<tr><td colspan="'+b.columns.length+'"><div style="display: block;text-align: center;">没有找到匹配的记录</div></td></tr>',d.html(h),void 0):(f.formatData(c),i=f.getRootNodes(),i&&a.each(i,function(a,b){var c="row_id_"+a;f.handleNode(b,1,c,"row_root",d)}),a.each(c,function(a,b){if(!b.isShow){var c=f.renderRow(b,!1,1);d.append(c)}}),f.append(d),g.css("width",d.children(":first").css("width")),f.find("tbody").find("tr").click(function(){if(e){var b=a(this).find("input[name='select_item']");"radio"==b.attr("type")?(b.prop("checked",!0),f.find("tbody").find("tr").removeClass("treetable-selected"),a(this).addClass("treetable-selected")):b.prop("checked")?(b.prop("checked",!1),a(this).removeClass("treetable-selected")):(b.prop("checked",!0),a(this).addClass("treetable-selected"))}}),f.find("tbody").find("tr").find(".treetable-expander").click(function(){var e,g,h,c=a(this).hasClass(b.expanderExpandedClass),d=a(this).hasClass(b.expanderCollapsedClass);(c||d)&&(e=a(this).parent().parent(),g=e.attr("id"),c?(h=f.find("tbody").find("tr[id^='"+g+"_']"),h&&h.length>0&&a.each(h,function(c,d){a(d).css("display","none");var e=a(d).children().eq(b.expandColumn).find(".treetable-expander");e.hasClass(b.expanderExpandedClass)&&(e.removeClass(b.expanderExpandedClass),e.addClass(b.expanderCollapsedClass))}),a(this).removeClass(b.expanderExpandedClass),a(this).addClass(b.expanderCollapsedClass)):(h=f.find("tbody").find("tr[pid='"+g+"']"),h&&h.length>0&&a.each(h,function(b,c){a(c).css("display","table")}),a(this).removeClass(b.expanderCollapsedClass),a(this).addClass(b.expanderExpandedClass)))}),void 0)},f.load(),f)},a.fn.bootstrapTreeTable.methods={getSelections:function(b){var f,g,d=b.find("tbody").find("tr").find("input[name='select_item']:checked"),e=[];return"radio"==d.attr("type")?(f={id:d.val()},g=d.parent().parent().find("td"),g.each(function(b,c){0!=b&&(f[a(c).attr("name")]=a(c).attr("title"))}),e.push(f)):d.each(function(b,c){var d={id:a(c).val()},f=a(c).parent().parent().find("td");f.each(function(b,c){0!=b&&(d[a(c).attr("name")]=a(c).attr("title"))}),e.push(d)}),e},refresh:function(a,b){b?a.load(b):a.load()}},a.fn.bootstrapTreeTable.defaults={id:"id",code:"id",parentCode:"parentId",rootCodeValue:null,data:null,type:"GET",url:null,ajaxParams:{},expandColumn:0,expandAll:!1,expandFirst:!0,striped:!1,bordered:!0,columns:[],toolbar:null,height:0,expanderExpandedClass:"glyphicon glyphicon-chevron-down",expanderCollapsedClass:"glyphicon glyphicon-chevron-right"}}(jQuery);